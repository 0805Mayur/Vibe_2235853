<!DOCTYPE html>
<html lang="en" class="h-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI-Powered Code Review Dashboard - Professional code analysis and review platform">
    <title>{% block title %}AI Code Review Dashboard{% endblock %}</title>
    <!-- Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Animate.css for subtle animations used in templates -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">

    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #60a5fa;
            --primary-dark: #1e40af;
            --success: #16a34a;
            --warning: #f59e0b;
            --danger: #dc2626;
            --info: #0ea5e9;

            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;

            --spacing-1: 0.25rem;
            --spacing-2: 0.5rem;
            --spacing-3: 0.75rem;
            --spacing-4: 1rem;
            --spacing-5: 1.25rem;
            --spacing-6: 1.5rem;

            --border-radius: 0.5rem;
            --border-radius-lg: 0.75rem;
            --border-radius-xl: 1rem;

            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;

            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);

            /* CR-prefixed design tokens for templates */
            --cr-primary: var(--primary);
            --cr-primary-light: #7aa7fb;
            --cr-primary-dark: var(--primary-dark);
            --cr-success: var(--success);
            --cr-warning: var(--warning);
            --cr-danger: var(--danger);
            --cr-info: var(--info);

            --cr-success-bg: #dcfce7;
            --cr-warning-bg: #fef3c7;
            --cr-danger-bg: #fee2e2;
            --cr-info-bg: #dbeafe;

            --cr-gray-50: var(--gray-50);
            --cr-gray-100: var(--gray-100);
            --cr-gray-200: var(--gray-200);
            --cr-gray-300: #d1d5db;
            --cr-gray-400: #9ca3af;
            --cr-gray-500: var(--gray-500);
            --cr-gray-600: var(--gray-600);
            --cr-gray-700: var(--gray-700);
            --cr-gray-800: var(--gray-800);
            --cr-gray-900: var(--gray-900);

            --cr-radius-sm: 0.375rem;
            --cr-radius-md: 0.5rem;
            --cr-radius-lg: 0.75rem;
            --cr-radius-xl: 1rem;

            --cr-spacing-xs: 0.25rem;
            --cr-spacing-sm: 0.5rem;
            --cr-spacing-md: 0.75rem;
            --cr-spacing-lg: 1rem;
            --cr-spacing-xl: 1.5rem;
            --cr-spacing-2xl: 2rem;

            --cr-font-size-sm: 0.875rem;
            --cr-font-size-base: 1rem;
            --cr-font-mono: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;

            --cr-shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --cr-shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --cr-shadow-lg: 0 10px 15px rgba(0,0,0,0.15);
        }

        body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji'; }

        /* Sidebar */
        .cr-sidebar {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: 280px;
            background: linear-gradient(180deg, #111827 0%, #1f2937 100%);
            color: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.15);
            overflow-y: auto;
            z-index: 1040;
        }

        /* Sidebar/Header/Navigation */
        .cr-sidebar-header { padding: var(--spacing-6); border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .cr-logo { display: flex; align-items: center; gap: var(--spacing-3); margin-bottom: var(--spacing-4); }
        .cr-logo-icon { width: 48px; height: 48px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); border-radius: var(--border-radius-lg); display: flex; align-items: center; justify-content: center; color: white; font-size: var(--font-size-xl); }
        .cr-logo-text h4 { color: white; font-weight: 700; font-size: var(--font-size-xl); margin: 0; }
        .cr-logo-text small { color: rgba(255, 255, 255, 0.7); font-size: var(--font-size-xs); text-transform: uppercase; letter-spacing: 0.5px; }
        .cr-status-indicator { display: flex; align-items: center; gap: var(--spacing-2); padding: var(--spacing-3) var(--spacing-4); background: rgba(5, 150, 105, 0.1); border: 1px solid rgba(5, 150, 105, 0.2); border-radius: var(--border-radius); color: #10b981; font-size: var(--font-size-sm); font-weight: 500; }
        .cr-status-indicator i { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .cr-system-stats { margin-top: var(--spacing-3); padding: var(--spacing-3) var(--spacing-4); background: rgba(255, 255, 255, 0.05); border-radius: var(--border-radius); font-size: var(--font-size-xs); color: rgba(255, 255, 255, 0.8); }

        .cr-nav { padding: var(--spacing-4) 0; }
        .cr-nav-link { display: flex; align-items: center; padding: var(--spacing-3) var(--spacing-6); color: rgba(255, 255, 255, 0.8); text-decoration: none; font-weight: 500; font-size: var(--font-size-sm); transition: all 0.2s ease; border-left: 3px solid transparent; }
        .cr-nav-link:hover { background: rgba(255, 255, 255, 0.1); color: white; border-left-color: var(--primary-light); transform: translateX(2px); }
        .cr-nav-link.active { background: rgba(37, 99, 235, 0.2); color: #93c5fd; border-left-color: var(--primary-light); }
        .cr-nav-link i { width: 20px; margin-right: var(--spacing-3); font-size: var(--font-size-sm); }
        
        /* Main Content */
        .cr-main-content { margin-left: 280px; min-height: 100vh; background: var(--gray-50); padding: var(--spacing-6); }
        .no-sidebar .cr-main-content { margin-left: 0; }
        
        /* Page Header */
        .cr-page-header { background: white; border-radius: var(--border-radius-xl); padding: var(--spacing-6); margin-bottom: var(--spacing-6); box-shadow: var(--shadow-sm); border: 1px solid var(--gray-200); }
        .cr-page-title { font-size: var(--font-size-3xl); font-weight: 700; color: var(--gray-900); margin-bottom: var(--spacing-2); }
        .cr-page-description { color: var(--gray-600); font-size: var(--font-size-base); }
        
        /* Cards */
        .cr-card { background: white; border-radius: var(--border-radius-xl); box-shadow: var(--shadow-sm); border: 1px solid var(--gray-200); margin-bottom: var(--spacing-6); overflow: hidden; transition: all 0.2s ease; }
        .cr-card:hover { box-shadow: var(--shadow-md); transform: translateY(-1px); }
        .cr-card-header { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); color: white; padding: var(--spacing-5) var(--spacing-6); border-bottom: none; }
        .cr-card-header h5 { font-size: var(--font-size-lg); font-weight: 600; margin: 0; }
        .cr-card-header small { color: rgba(255, 255, 255, 0.8); font-size: var(--font-size-sm); }
        .cr-card-body { padding: var(--spacing-6); }
        
        /* Buttons */
        .cr-btn { display: inline-flex; align-items: center; justify-content: center; gap: var(--spacing-2); padding: var(--spacing-3) var(--spacing-5); font-size: var(--font-size-sm); font-weight: 600; border-radius: var(--border-radius); border: none; cursor: pointer; text-decoration: none; transition: all 0.2s ease; box-shadow: var(--shadow-sm); }
        .cr-btn:hover { transform: translateY(-1px); box-shadow: var(--shadow-md); }
        .cr-btn-primary { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); color: white; }
        .cr-btn-primary:hover { background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%); color: white; }
        .cr-btn-secondary { background: var(--gray-100); color: var(--gray-700); }
        .cr-btn-secondary:hover { background: var(--gray-200); color: var(--gray-800); }
        .cr-btn-success { background: linear-gradient(135deg, var(--success) 0%, #10b981 100%); color: white; }
        .cr-btn-danger { background: linear-gradient(135deg, var(--danger) 0%, #ef4444 100%); color: white; }
        .cr-btn-lg { padding: var(--spacing-4) var(--spacing-6); font-size: var(--font-size-base); }
        .cr-btn-sm { padding: var(--spacing-2) var(--spacing-4); font-size: var(--font-size-xs); }
        
        /* Form Elements */
        .cr-form-control { width: 100%; padding: var(--spacing-3) var(--spacing-4); font-size: var(--font-size-sm); border: 2px solid var(--gray-200); border-radius: var(--border-radius); background: white; color: var(--gray-900); transition: all 0.2s ease; }
        .cr-form-control:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        .cr-form-label { display: block; font-size: var(--font-size-sm); font-weight: 600; color: var(--gray-700); margin-bottom: var(--spacing-2); }
        
        /* Badges */
        .cr-badge { display: inline-flex; align-items: center; padding: var(--spacing-1) var(--spacing-3); font-size: var(--font-size-xs); font-weight: 600; border-radius: 9999px; text-transform: uppercase; letter-spacing: 0.025em; }
        .cr-badge-success { background: #dcfce7; color: #166534; }
        .cr-badge-warning { background: #fef3c7; color: #92400e; }
        .cr-badge-danger { background: #fecaca; color: #991b1b; }
        .cr-badge-info { background: #dbeafe; color: #1e40af; }
        .cr-badge-secondary { background: var(--gray-100); color: var(--gray-700); }
        
        /* Alerts */
        .alert { padding: var(--spacing-4) var(--spacing-5); border-radius: var(--border-radius-lg); border: 1px solid transparent; margin-bottom: var(--spacing-4); font-weight: 500; }
        .alert-success { background: #f0fdf4; color: #166534; border-color: #bbf7d0; }
        .alert-warning { background: #fffbeb; color: #92400e; border-color: #fde68a; }
        .alert-danger { background: #fef2f2; color: #991b1b; border-color: #fecaca; }
        .alert-info { background: #eff6ff; color: #1e40af; border-color: #bfdbfe; }
        
        /* Tables */
        .table { width: 100%; background: white; border-radius: var(--border-radius-lg); overflow: hidden; box-shadow: var(--shadow-sm); border: 1px solid var(--gray-200); }
        .table thead th { background: var(--gray-50); color: var(--gray-700); font-weight: 600; font-size: var(--font-size-sm); padding: var(--spacing-4) var(--spacing-5); border-bottom: 1px solid var(--gray-200); text-align: left; }
        .table tbody td { padding: var(--spacing-4) var(--spacing-5); color: var(--gray-600); border-bottom: 1px solid var(--gray-100); font-size: var(--font-size-sm); }
        .table tbody tr:hover { background: var(--gray-50); }
        
        /* Loading Animation */
        .cr-loading { display: inline-block; width: 16px; height: 16px; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top-color: currentColor; animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Responsive */
        @media (max-width: 1024px) {
            .cr-sidebar { transform: translateX(-100%); transition: transform 0.3s ease; }
            .cr-sidebar.show { transform: translateX(0); }
            .cr-main-content { margin-left: 0; padding: var(--spacing-4); }
        }
        @media (max-width: 768px) {
            .cr-page-header { padding: var(--spacing-4); }
            .cr-card-body { padding: var(--spacing-4); }
            .cr-btn { padding: var(--spacing-3) var(--spacing-4); font-size: var(--font-size-xs); }
        }

        /* Utilities */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .d-flex { display: flex; }
        .align-items-center { align-items: center; }
        .justify-content-between { justify-content: space-between; }
        .gap-2 { gap: var(--spacing-2); }
        .gap-3 { gap: var(--spacing-3); }
        .gap-4 { gap: var(--spacing-4); }
        .mb-2 { margin-bottom: var(--spacing-2); }
        .mb-3 { margin-bottom: var(--spacing-3); }
        .mb-4 { margin-bottom: var(--spacing-4); }
        .mt-3 { margin-top: var(--spacing-3); }
        .mt-4 { margin-top: var(--spacing-4); }
        .me-2 { margin-right: var(--spacing-2); }
        .me-3 { margin-right: var(--spacing-3); }
        .fw-bold { font-weight: 700; }
        .fw-semibold { font-weight: 600; }
        .text-muted { color: var(--gray-500); }
        .text-success { color: var(--success); }
        .text-warning { color: var(--warning); }
        .text-danger { color: var(--danger); }
        .text-info { color: var(--info); }
    </style>
    
    {% block extra_css %}{% endblock %}
</head>
<body class="d-flex h-100 {% if not user %}no-sidebar{% endif %}">
    <a href="#main-content" class="sr-only">Skip to main content</a>
    
    {% if user %}
        <nav class="cr-sidebar" id="sidebar">
            <div class="cr-sidebar-header">
                <div class="cr-logo">
                    <div class="cr-logo-icon"><i class="fas fa-robot"></i></div>
                    <div class="cr-logo-text">
                        <h4>AI Code Review</h4>
                        <small>Enterprise Dashboard</small>
                    </div>
                </div>
                <div class="cr-status-indicator">
                    <i class="fas fa-circle"></i>
                    <span>All systems operational</span>
                </div>
                <div class="cr-system-stats">
                    <div>Signed in as <strong>{{ (user.full_name or user.username) if user else '' }}</strong></div>
                </div>
            </div>

            <div class="cr-nav">
                <a class="cr-nav-link {{ 'active' if request.endpoint == 'index' else '' }}" href="{{ url_for('index') }}">
                    <i class="fas fa-gauge"></i> Dashboard
                </a>
                <a class="cr-nav-link {{ 'active' if request.endpoint == 'repositories' else '' }}" href="{{ url_for('repositories') }}">
                    <i class="fab fa-github"></i> Repositories
                </a>
                <a class="cr-nav-link {{ 'active' if request.endpoint == 'pr_review' else '' }}" href="{{ url_for('pr_review') }}">
                    <i class="fas fa-code-branch"></i> PR Review
                </a>
                <a class="cr-nav-link {{ 'active' if request.endpoint == 'code_analysis' else '' }}" href="{{ url_for('code_analysis') }}">
                    <i class="fas fa-bug"></i> Code Analysis
                </a>
                <a class="cr-nav-link {{ 'active' if request.endpoint == 'ai_assistant' else '' }}" href="{{ url_for('ai_assistant') }}">
                    <i class="fas fa-comment-dots"></i> AI Assistant
                </a>
                <a class="cr-nav-link {{ 'active' if request.endpoint == 'analytics' else '' }}" href="{{ url_for('analytics') }}">
                    <i class="fas fa-chart-line"></i> Analytics
                </a>
                <a class="cr-nav-link {{ 'active' if request.endpoint == 'reviews' else '' }}" href="{{ url_for('reviews') }}">
                    <i class="fas fa-list"></i> Reviews
                </a>
                <a class="cr-nav-link {{ 'active' if request.endpoint == 'enterprise_dashboard' else '' }}" href="{{ url_for('enterprise_dashboard') }}">
                    <i class="fas fa-rocket"></i> Enterprise
                </a>
                <a class="cr-nav-link {{ 'active' if request.endpoint == 'compliance' else '' }}" href="{{ url_for('compliance') }}">
                    <i class="fas fa-shield-alt"></i> Compliance
                </a>
                <a class="cr-nav-link {{ 'active' if request.endpoint == 'settings' else '' }}" href="{{ url_for('settings') }}">
                    <i class="fas fa-gear"></i> Settings
                </a>
                <a class="cr-nav-link" href="{{ url_for('logout') }}">
                    <i class="fas fa-right-from-bracket"></i> Logout
                </a>
            </div>
        </nav>
    {% endif %}

    <main id="main-content" class="cr-main-content {% if not user %}w-100{% endif %}">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="mb-4">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ 'danger' if category in ['error','danger'] else category }} alert-dismissible fade show">
                            <i class="fas fa-{{ 'exclamation-triangle' if category == 'warning' else 'check-circle' if category == 'success' else 'info-circle' }} me-2"></i>
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </main>

    <!-- JS Bundles -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script>
    window.CodeReviewUI = {
        showToast(message, type = 'info', timeout = 3000) {
            try {
                const toast = document.createElement('div');
                const typeClass = type === 'success' ? 'success' : type === 'error' ? 'danger' : type === 'warning' ? 'warning' : 'info';
                const icon = type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle';
                toast.className = `alert alert-${typeClass} position-fixed shadow`;
                toast.style.cssText = 'top: 20px; right: 20px; z-index: 1055; min-width: 280px;';
                toast.innerHTML = `<i class="fas fa-${icon} me-2"></i>${message}`;
                document.body.appendChild(toast);
                setTimeout(() => { if (toast.parentNode) toast.parentNode.removeChild(toast); }, timeout);
            } catch (e) {
                console.warn('Toast failed:', e);
                alert(message);
            }
        },
        copyToClipboard(text) {
            if (!text) return;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => this.showToast('Copied to clipboard', 'success')); 
            } else {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.focus();
                textarea.select();
                try { document.execCommand('copy'); this.showToast('Copied to clipboard', 'success'); } catch (_) {}
                document.body.removeChild(textarea);
            }
        }
    };
    // Global alias used in some pages
    window.showToast = (message, type = 'info', timeout = 3000) => window.CodeReviewUI.showToast(message, type, timeout);
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>